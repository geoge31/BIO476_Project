---
title: "BIO476 - PROJECT 2024"
author: '@csd3927/ @csd4748'
date: "05-06-2024"
output:
  html_notebook: default
  pdf_document: default
---

------------------------------------------------------------------------

# Τeam

#### Γιώργος Γεραμούτσος, csd3927

#### Θεοδώρα Συμεωνίδου, csd4748

------------------------------------------------------------------------

## Github Link : [BIO476_PROJECT](https://github.com/geoge31/BIO476_Project.git)

------------------------------------------------------------------------

# Project

<br>

### Libraries

```{r}
library(limma)
library(matrixStats)
library(ggplot2)
library(tidyr)
```

```{r}
pr_List = list()
```

------------------------------------------------------------------------

<br>

#### 1. Κατεβάστε το dataset και φορτώστε το στην R

```{r}
gds_6010 = readLines("GDS6010.soft")
gds_6010_cleaned = gds_6010[!grepl("[!^#]",gds_6010)]
writeLines(gds_6010_cleaned,"GDS6010.soft")

samples = read.table("GDS6010.soft", sep = "\t", header=T, na.strings="null")

samples = samples[ , 3:ncol(samples)]

pr_List[[1]] = "Samples"
pr_List[[2]] = samples

print(pr_List)
```

------------------------------------------------------------------------

<br>

#### 2. Χρησιμοποιήστε μόνο τα δείγματα που αντιστοιχούν στις 6 και στις 24 ώρες και χρησιμοποιήστε αυτές τις κατηγορίες ώς παράγοντα (factor) με 2 levels: 6 και 24. 

```{r}
pr_List = NULL

exps = samples[ , c(1:6, 13:18)]

time_points = c(rep(6,6), rep(24,6))
time_factor = factor(time_points, levels=c(6,24))

infection_status = factor(rep(rep(c("infection","control"), each=3),2))
infection_factor = factor(infection_status, levels = c("infection", "control"))

pr_List[[1]] = "Time Factor"
pr_List[[2]] = time_factor
pr_List[[3]] = "Infection Factor"
pr_List[[4]] = infection_factor

print(pr_List)
```

<br>

#### 3. Βρείτε ποια γονίδια διαφοροποιούνται μεταξύ των 6 και 24 ωρών παίρνοντας υπόψιν και τον παράγοντα infection (γραμμικά μοντέλα με 2 παράγοντες με αλληλεπίδραση). 

```{r}
pr_List = NULL

design = model.matrix(~ 0 + time_factor * infection_factor)
colnames(design) = c("time_6", "time_24", "infection_control", "time_24Xinfection_control")
# design

pr_List[[1]] = "Design"
pr_List[[2]] = design

print(pr_List)
```

```{r}
pr_List = NULL

fitA = lmFit(exps, design)
# fitA 

pr_List[[1]] = "fit A"
pr_List[[2]] = fitA

print(pr_List)
```

```{r}
pr_List = NULL

contrasts = makeContrasts(time24h_vs_time6h = time_24-time_6, levels=design)
# contrasts

pr_List[[1]] = "Contrasts"
pr_List[[2]] = contrasts

print(pr_List)
```

```{r}
pr_List = NULL

fitB = contrasts.fit(fitA, contrasts)
fitB = eBayes(fitB)
# fitB

pr_List[[1]] = "fit B"
pr_List[[2]] = fitB

print(pr_List)
```

```{r}
pr_List = NULL

top_table = topTable(fitB, adjust.method="fdr", number=Inf)
#top_table
significant_genes = top_table[top_table$adj.P.Val < 0.05 & abs(top_table$logFC) > 1, ]
# significant_genes

pr_List[[1]] = "Adjustes Significant Genes"
pr_List[[2]] = significant_genes

print(pr_List)
```

------------------------------------------------------------------------

<br>

#### 4. Θεωρείτε ότι η μόλυνση με H5N1 προκαλεί συστημική αντίδραση στον οργανισμό (δηλαδή επηρεάζονται πολλά γονίδια) ή επηρεάζονται μόνο λίγα γονίδια;

```{r}
percentage = nrow(significant_genes) / nrow(exps) * 100
cat("Percentage of affected genes: \n",percentage)

```

Το ποσοστό των γονιδίων που αλλάζουν είναι περίπου 10% (9.696409%). Αλλαγές στο 10% των γονιδίων είναι αρκετά σίγουρο πως θα προκαλέσουν συστημίκη αντίδραση

```{r}
pr_List = NULL

pr_List[[1]] = "Statistical Analysis"
pr_List[[2]] = summary(significant_genes$logFC)
pr_List[[3]] = summary(significant_genes$adj.P.Val)
pr_List
```

Μπορούμε να συμπεράνουμε ότι η μόλυνση Η5Ν1 επηρεάζει πολλά γονίδια προκαλώντας συστημηκιή αντίδραση στον οργανισμό

-   **logFC**

    -   Η μεταβολή κυμαίνεται από -5.18156 εώς 5.3429, το οποίο δείχνει ότι η μόλυνση προκαλεί μεγάλες αλλαγές στην έκφραση αρκετών γονιδίων

-   **adjusted p-values**

    -   Όλες οι τιμές είναι μικρότερες από 0.05 που τις καθορίζει σταστιστικά σημαντικές για την έκφραση των γονιδίων

-   **plot**

```{r}
top_table_clean = na.omit(top_table)

ggplot(top_table_clean, aes(x=logFC, y=-log10(adj.P.Val))) +
  geom_point(aes(color=adj.P.Val < 0.05 & abs(logFC) > 1)) +
  scale_color_manual(values=c("grey", "red")) +
  theme_minimal() +
  labs(title="Table Plot", x="Log Fold Change", y="-Log10 Adjusted P-Value")
```

------------------------------------------------------------------------

<br>

#### 5. Χρησιμοποιήστε την lm συνάρτηση ώστε να δείτε σε ένα μοντέλο με αλληλεπίδραση ποιοι παράγοντες ειναι σημαντικοί.

```{r}
exps_df = as.data.frame(t(exps))

exps_df$time_factor = time_factor
exps_df$infection_factor = infection_factor
```

```{r}
significant_gens_list = list()

for (gene in colnames(exps_t)[1:5]) {  # Only consider the first few genes for debugging
  # Create a combined data frame for each gene
  gene_expression <- exps_t[, gene]
  exps_df <- data.frame(gene_expression, time_factor, infection_factor)
  
  # Fit the linear model
  model <- lm(gene_expression ~ time_factor * infection_factor, data = exps_df)
  summary_model <- summary(model)
  
  # Print summary of the model for the first few genes
  cat("Summary for gene:", gene, "\n")
  print(summary_model)
  
  # Extract significant factors
  significant_factors <- summary_model$coefficients[summary_model$coefficients[, "Pr(>|t|)"] < 0.05, ]
  
  if (nrow(significant_factors) > 0) {
    significant_genes_list[[gene]] <- significant_factors
  }
}

# Print significant genes and their factors
for (gene in names(significant_genes_list)) {
  cat("Gene:", gene, "\n")
  print(significant_genes_list[[gene]])
}

# Debug: Print the number of significant genes found
cat("Number of significant genes found:", length(significant_genes_list), "\n")

```

```{r}
model = lm(gene_expression ~ time_factor * infection_factor, data=exps)
```

```{r}

gene_expression = exps[, "GSM1626004"]
#gene_expression

exps_df <- data.frame(gene_expression, time_factor, infection_factor)

model <- lm(gene_expression ~ time_factor * infection_factor, data = exps_df)

```
